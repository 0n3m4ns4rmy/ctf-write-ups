from pwn import *
from Crypto.Cipher import AES

def encrypt(message):
	context.log_level = 'ERROR'
	#r = process('./run.sh')
	r = remote('chal.420blaze.in', 42009)

	r.sendafter('What message should I encrypt?\n', message + '')

	r.shutdown('send')

	r.recvuntil('Encrypted input:\n')

	encrypted_input = r.recvuntil('\n').split('\n')[0]

	r.recvuntil('Encrypted flag:\n')

	encrypted_flag = r.recvuntil('\n').split('\n')[0]

	r.close()

	context.log_level = 'INFO'

	return [encrypted_input, encrypted_flag]

'''
for i in range(0x100):
	print i
	print encrypt('A'*i + 'thisisakey')
'''

encrypted_flag = encrypt('A'*100)[1]

encrypted_flag_cipthertext_buf = encrypted_flag.decode('hex')

obj = AES.new('A'*16, AES.MODE_CBC, '\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f')

flag = obj.decrypt(encrypted_flag_cipthertext_buf)

print flag
